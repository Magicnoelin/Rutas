<!DOCTYPE html>
<html lang="es">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-X990K5GE42"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-X990K5GE42');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Rutas Turismo Rural</title>
    <link rel="icon" href="favicon.png" type="image/png">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .dashboard-container {
            margin-top: 100px;
            padding: 2rem;
            min-height: calc(100vh - 100px);
        }

        .dashboard-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .dashboard-title {
            font-size: 2.5rem;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .dashboard-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border-left: 4px solid var(--primary-color);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }

        .stat-card.primary { border-left-color: var(--primary-color); }
        .stat-card.secondary { border-left-color: var(--secondary-color); }
        .stat-card.accent { border-left-color: var(--accent-color); }
        .stat-card.success { border-left-color: #27ae60; }

        .stat-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .stat-icon.primary { background: var(--primary-color); }
        .stat-icon.secondary { background: var(--secondary-color); }
        .stat-icon.accent { background: var(--accent-color); }
        .stat-icon.success { background: #27ae60; }

        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--dark-color);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #666;
            font-size: 1rem;
            margin-bottom: 0.5rem;
        }

        .stat-trend {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #27ae60;
            font-size: 0.9rem;
        }

        .stat-trend.negative {
            color: #e74c3c;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .chart-card {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: var(--shadow);
        }

        .chart-title {
            font-size: 1.3rem;
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        .recent-activity {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 0;
            border-bottom: 1px solid #eee;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--light-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-color);
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-weight: 500;
            color: var(--dark-color);
            margin-bottom: 0.2rem;
        }

        .activity-time {
            color: #666;
            font-size: 0.85rem;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .quick-action-btn {
            background: var(--primary-color);
            color: white;
            padding: 1.5rem;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 1rem;
            text-align: left;
            font-size: 1rem;
        }

        .quick-action-btn:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
        }

        .quick-action-btn i {
            font-size: 1.5rem;
        }

        .refresh-btn {
            background: var(--accent-color);
            color: white;
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .refresh-btn:hover {
            background: #c49563;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
            color: var(--primary-color);
        }

        @media (max-width: 768px) {
            .dashboard-container {
                padding: 1rem;
            }

            .dashboard-title {
                font-size: 2rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .charts-grid {
                grid-template-columns: 1fr;
            }

            .chart-container {
                height: 250px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <nav class="navbar">
            <div class="container">
                <div class="logo">
                    <img src="logo_990x1076_verde.png" alt="Rutas Logo" style="height: 50px; margin-right: 10px;">
                    <span>Rutas</span>
                </div>
                <ul class="nav-menu">
                    <li><a href="index.html">Inicio</a></li>
                    <li><a href="alojamientos.html">Alojamientos</a></li>
                    <li><a href="agregar-alojamiento.html">Añadir Alojamiento</a></li>
                    <li><a href="dashboard.html" class="active">Dashboard</a></li>
                    <li><a href="index.html#asistente" class="btn-asistente">Asistente IA</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <!-- Dashboard -->
    <div class="dashboard-container">
        <!-- Header -->
        <div class="dashboard-header">
            <h1 class="dashboard-title">
                <i class="fas fa-chart-line"></i>
                Dashboard de Turismo Rural
            </h1>
            <div class="dashboard-actions">
                <button class="refresh-btn" onclick="refreshData()">
                    <i class="fas fa-sync-alt"></i>
                    Actualizar Datos
                </button>
            </div>
        </div>

        <!-- Loading -->
        <div class="loading" id="loading">
            <i class="fas fa-spinner fa-spin"></i>
            <p>Cargando datos del dashboard...</p>
        </div>

        <!-- Statistics Cards -->
        <div class="stats-grid" id="statsGrid">
            <div class="stat-card primary">
                <div class="stat-header">
                    <div class="stat-icon primary">
                        <i class="fas fa-home"></i>
                    </div>
                </div>
                <div class="stat-value" id="totalAlojamientos">17</div>
                <div class="stat-label">Total Alojamientos</div>
                <div class="stat-trend">
                    <i class="fas fa-arrow-up"></i>
                    <span>+2 este mes</span>
                </div>
            </div>

            <div class="stat-card secondary">
                <div class="stat-header">
                    <div class="stat-icon secondary">
                        <i class="fas fa-users"></i>
                    </div>
                </div>
                <div class="stat-value" id="totalPlazas">142</div>
                <div class="stat-label">Plazas Totales</div>
                <div class="stat-trend">
                    <i class="fas fa-arrow-up"></i>
                    <span>+15 nuevas plazas</span>
                </div>
            </div>

            <div class="stat-card accent">
                <div class="stat-header">
                    <div class="stat-icon accent">
                        <i class="fas fa-euro-sign"></i>
                    </div>
                </div>
                <div class="stat-value" id="precioMedio">€135</div>
                <div class="stat-label">Precio Medio/Noche</div>
                <div class="stat-trend">
                    <i class="fas fa-arrow-up"></i>
                    <span>+5€ vs mes anterior</span>
                </div>
            </div>

            <div class="stat-card success">
                <div class="stat-header">
                    <div class="stat-icon success">
                        <i class="fas fa-star"></i>
                    </div>
                </div>
                <div class="stat-value" id="ocupacionMedia">78%</div>
                <div class="stat-label">Ocupación Media</div>
                <div class="stat-trend">
                    <i class="fas fa-arrow-up"></i>
                    <span>+12% vs mes anterior</span>
                </div>
            </div>
        </div>

        <!-- Charts -->
        <div class="charts-grid">
            <div class="chart-card">
                <h3 class="chart-title">
                    <i class="fas fa-chart-bar"></i>
                    Distribución por Tipo de Alojamiento
                </h3>
                <div class="chart-container">
                    <canvas id="tipoChart"></canvas>
                </div>
            </div>

            <div class="chart-card">
                <h3 class="chart-title">
                    <i class="fas fa-map-marker-alt"></i>
                    Alojamientos por Localidad
                </h3>
                <div class="chart-container">
                    <canvas id="localidadChart"></canvas>
                </div>
            </div>
        </div>

        <div class="charts-grid">
            <div class="chart-card">
                <h3 class="chart-title">
                    <i class="fas fa-calendar"></i>
                    Ocupación Mensual
                </h3>
                <div class="chart-container">
                    <canvas id="ocupacionChart"></canvas>
                </div>
            </div>

            <div class="chart-card">
                <h3 class="chart-title">
                    <i class="fas fa-euro-sign"></i>
                    Precios por Rango
                </h3>
                <div class="chart-container">
                    <canvas id="preciosChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="recent-activity">
            <h3 class="chart-title">
                <i class="fas fa-clock"></i>
                Actividad Reciente
            </h3>
            <div class="activity-item">
                <div class="activity-icon">
                    <i class="fas fa-plus"></i>
                </div>
                <div class="activity-content">
                    <div class="activity-title">Nuevo alojamiento añadido: Casa Rural Pariseo</div>
                    <div class="activity-time">Hace 2 horas</div>
                </div>
            </div>
            <div class="activity-item">
                <div class="activity-icon">
                    <i class="fas fa-star"></i>
                </div>
                <div class="activity-content">
                    <div class="activity-title">Calificación actualizada: La Plaza (4.8★)</div>
                    <div class="activity-time">Hace 4 horas</div>
                </div>
            </div>
            <div class="activity-item">
                <div class="activity-icon">
                    <i class="fas fa-eye"></i>
                </div>
                <div class="activity-content">
                    <div class="activity-title">Casa Enrique: 150 visualizaciones hoy</div>
                    <div class="activity-time">Hace 6 horas</div>
                </div>
            </div>
            <div class="activity-item">
                <div class="activity-icon">
                    <i class="fas fa-phone"></i>
                </div>
                <div class="activity-content">
                    <div class="activity-title">8 consultas telefónicas recibidas</div>
                    <div class="activity-time">Hoy</div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
            <button class="quick-action-btn" onclick="window.location.href='agregar-alojamiento.html'">
                <i class="fas fa-plus"></i>
                <div>
                    <strong>Añadir Alojamiento</strong><br>
                    <small>Registrar nuevo establecimiento</small>
                </div>
            </button>
            <button class="quick-action-btn" onclick="window.location.href='alojamientos.html'">
                <i class="fas fa-edit"></i>
                <div>
                    <strong>Gestionar Alojamientos</strong><br>
                    <small>Editar y actualizar datos</small>
                </div>
            </button>
            <button class="quick-action-btn" onclick="window.location.href='index.html#asistente'">
                <i class="fas fa-robot"></i>
                <div>
                    <strong>Asistente IA</strong><br>
                    <small>Consultar estadísticas</small>
                </div>
            </button>
            <button class="quick-action-btn" onclick="exportData()">
                <i class="fas fa-download"></i>
                <div>
                    <strong>Exportar Datos</strong><br>
                    <small>Descargar informe completo</small>
                </div>
            </button>
        </div>
    </div>

    <script>
        let charts = {};

        // Inicializar dashboard
        document.addEventListener('DOMContentLoaded', function() {
            loadAlojamientosData();
            initializeCharts();
            
            // Simular actualización automática cada 5 minutos
            setInterval(refreshData, 300000);
        });

        async function loadAlojamientosData() {
            try {
                const response = await fetch('alojamientos.json');
                const alojamientos = await response.json();
                
                updateStatistics(alojamientos);
                updateCharts(alojamientos);
                
            } catch (error) {
                console.error('Error cargando datos:', error);
            }
        }

        function updateStatistics(alojamientos) {
            const total = alojamientos.length;
            const totalPlazas = alojamientos.reduce((sum, a) => sum + a.plazas, 0);
            const precios = alojamientos.filter(a => a.precio).map(a => a.precio);
            const precioMedio = precios.length > 0 ? Math.round(precios.reduce((sum, p) => sum + p, 0) / precios.length) : 0;
            
            // Animar números
            animateValue('totalAlojamientos', 0, total, 1000);
            animateValue('totalPlazas', 0, totalPlazas, 1500);
            animateValue('precioMedio', 0, precioMedio, 2000, '€');
            animateValue('ocupacionMedia', 0, 78, 2500, '%');
        }

        function animateValue(id, start, end, duration, suffix = '') {
            const element = document.getElementById(id);
            const range = end - start;
            const startTime = performance.now();
            
            function update(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const current = Math.floor(progress * range + start);
                
                element.textContent = current + suffix;
                
                if (progress < 1) {
                    requestAnimationFrame(update);
                }
            }
            
            requestAnimationFrame(update);
        }

        function initializeCharts() {
            // Gráfico de tipos
            const tipoCtx = document.getElementById('tipoChart').getContext('2d');
            charts.tipo = new Chart(tipoCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Casa', 'Piso', 'Chalé', 'Apartamento', 'Hotel Rural'],
                    datasets: [{
                        data: [12, 3, 1, 1, 0],
                        backgroundColor: [
                            '#2c5f2d',
                            '#87a96b', 
                            '#d4a574',
                            '#95a5a6',
                            '#e74c3c'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            // Gráfico de localidades
            const localidadCtx = document.getElementById('localidadChart').getContext('2d');
            charts.localidad = new Chart(localidadCtx, {
                type: 'bar',
                data: {
                    labels: ['Vinuesa', 'San Leonardo', 'Garray', 'Ligos', 'Otros'],
                    datasets: [{
                        label: 'Número de Alojamientos',
                        data: [4, 3, 2, 2, 6],
                        backgroundColor: '#2c5f2d'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });

            // Gráfico de ocupación
            const ocupacionCtx = document.getElementById('ocupacionChart').getContext('2d');
            charts.ocupacion = new Chart(ocupacionCtx, {
                type: 'line',
                data: {
                    labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'],
                    datasets: [{
                        label: 'Ocupación (%)',
                        data: [65, 58, 72, 78, 85, 88, 92, 95, 82, 75, 68, 70],
                        borderColor: '#2c5f2d',
                        backgroundColor: 'rgba(44, 95, 45, 0.1)',
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });

            // Gráfico de precios
            const preciosCtx = document.getElementById('preciosChart').getContext('2d');
            charts.precios = new Chart(preciosCtx, {
                type: 'bar',
                data: {
                    labels: ['< 100€', '100-150€', '150-200€', '> 200€'],
                    datasets: [{
                        label: 'Número de Alojamientos',
                        data: [3, 8, 4, 2],
                        backgroundColor: ['#27ae60', '#f39c12', '#e74c3c', '#8e44ad']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        function updateCharts(alojamientos) {
            // Actualizar gráficos con datos reales
            if (charts.tipo) {
                const tipos = {};
                alojamientos.forEach(a => {
                    tipos[a.tipo] = (tipos[a.tipo] || 0) + 1;
                });
                charts.tipo.data.datasets[0].data = Object.values(tipos);
                charts.tipo.update();
            }
        }

        function refreshData() {
            const loading = document.getElementById('loading');
            loading.style.display = 'block';
            
            setTimeout(() => {
                loadAlojamientosData();
                loading.style.display = 'none';
                
                // Actualizar actividad reciente
                updateRecentActivity();
            }, 1500);
        }

        function updateRecentActivity() {
            const activities = [
                { title: 'Dashboard actualizado con datos frescos', time: 'Hace unos segundos', icon: 'sync' },
                { title: 'Análisis de ocupación completado', time: 'Hace 5 min', icon: 'chart-line' },
                { title: 'Nuevas consultas procesadas por IA', time: 'Hace 10 min', icon: 'robot' },
                { title: 'Reporte mensual generado automáticamente', time: 'Hace 15 min', icon: 'file-alt' }
            ];
            
            // Aquí podrías actualizar dinámicamente la lista de actividad
        }

        function exportData() {
            // Simular exportación
            const data = {
                fecha: new Date().toISOString(),
                totalAlojamientos: 17,
                totalPlazas: 142,
                precioMedio: 135,
                ocupacionMedia: 78
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `rutas-dashboard-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Auto-refresh cada 30 segundos para estadísticas en tiempo real
        setInterval(() => {
            // Simular pequeñas fluctuaciones en ocupación
            const ocupacion = document.getElementById('ocupacionMedia');
            const current = parseInt(ocupacion.textContent);
            const variation = Math.floor(Math.random() * 6) - 3; // -3 a +3
            const newValue = Math.max(60, Math.min(95, current + variation));
            ocupacion.textContent = newValue + '%';
        }, 30000);
    </script>
</body>
</html>
